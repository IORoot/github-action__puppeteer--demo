name: (RUN) Instagram Scheduler

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:

  build:

    runs-on: ubuntu-latest

    services:
      myservice1:
        image: londonparkour/igs:latest
        credentials:
          username: londonparkour
          password: ${{ secrets.docker_hub_password}}
        ports:
          - 8080:8080


    steps:

      - uses: actions/checkout@v1
            
      # Open Ports
      - name: IPTables all ports open
        run: |
          sudo iptables -I INPUT -j ACCEPT


      - name: Custom NGROK SSH Action
        uses: ./.github/actions/ngrok
        with:
          NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
          SSH_PASS: ${{ secrets.NGROK_SSH_PASS }}
          NGROK_REGION: eu
          NGROK_PORT: 80

      # # DEBUG with NGROK.
      # - name: Start SSH session
      #   uses: luchihoratiu/debug-via-ssh@main
      #   with:
      #     NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
      #     SSH_PASS: ${{ secrets.NGROK_SSH_PASS }}
      #     NGROK_REGION: eu